<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Kalender Hijriyah</title>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:400,500,600&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --primary-color: #213555;
        --primary-hover: #0056b3;
        --background-color: #213555;
        --card-bg: white;
        --diamond-bg: #4f709c;
        --text-color: #0056b3;
        --secondary-text: #9ca3af;
        --hadith-bg: #f0f0f0;
        --hadith-text-color: black;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: var(--background-color);
        padding: 20px;
        color: var(--text-color);
        margin: 0;
      }

      h1 {
        text-align: center;
        color: var(--card-bg);
        margin-bottom: 30px;
      }

      .year-header {
        text-align: center;
        color: var(--card-bg);
        margin-bottom: 20px;
        font-size: 1.4rem;
      }

      .btn-container {
        text-align: center;
        margin-bottom: 20px;
      }

      .btn-year {
        margin: 0 5px;
        border-color: var(--card-bg);
        color: var(--card-bg);
        background-color: transparent;
      }
      .btn-year:hover {
        background-color: var(--primary-hover);
        border-color: var(--primary-hover);
        color: #fff;
      }

      .btn-year-mobile {
        margin: 0 5px;
        border-color: var(--card-bg);
        color: var(--card-bg);
        background-color: transparent;
      }

      /* Grid untuk kalender */
      .year-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-row-gap: 30px;
        grid-column-gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }

      /* Card bulan */
      .month-card {
        background-color: var(--card-bg);
        border: 1px solid var(--diamond-bg);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .month-header {
        background: var(--diamond-bg);
        color: #fff;
        text-align: center;
        padding: 8px 0;
        font-weight: 600;
      }

      .day-names {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        font-weight: 600;
        font-size: 0.8rem;
        border-bottom: 1px solid var(--diamond-bg);
        background-color: var(--card-bg);
      }
      .day-names div {
        padding: 6px 0;
        color: var(--text-color);
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        grid-auto-rows: 50px;
        gap: 2px;
        padding: 6px;
      }

      .calendar-cell {
        border: 1px solid var(--diamond-bg);
        border-radius: 4px;
        background: var(--card-bg);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 0.75rem;
        padding: 2px;
        position: relative;
      }

      .date-hijri {
        color: #213555;
        padding: 2px 4px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.8rem;
      }

      .date-greg {
        font-size: 0.7rem;
        color: #4c585b;
        margin-top: 2px;
      }
      .month-header {
        background: var(--diamond-bg);
        color: #fff;
        padding: 8px 0;
        font-weight: 600;
      }

      /* Wadah fleksibel di dalam month-header */
      .header-container {
        display: flex; /* Aktifkan Flexbox */
        justify-content: space-between; /* Hijri di kiri, tanggal di kanan */
        align-items: center; /* Vertikal center */
        margin: 0 10px; /* Jarak horizontal */
      }

      .hijri-left {
        font-size: 1.2rem; /* Sesuaikan ukuran font */
        font-weight: bold;
      }

      .date-right {
        text-align: right; /* Teks rata kanan */
        font-size: 0.85rem; /* Ukuran font lebih kecil */
      }

      .calendar-cell.sunday .date-hijri,
      .calendar-cell.sunday .date-greg {
        color: #b82132 !important;
      }

      /* Highlight default puasa Senin-Kamis dan Ayyamul Bidh */
      .puasa-senin-kamis {
        background-color: #a1e3f9 !important;
        color: #fff;
      }

      .puasa-ayyamul-bidh {
        background-color: #fca997 !important;
        color: #fff;
      }

      /* Highlight khusus untuk Ramadhan (1-30) */
      .puasa-ramadhan {
        background-color: #d0e8c5 !important;
        color: #fff;
      }

      /* Highlight untuk 1 Syawal (Idul Fitri) */
      .idul-fitri {
        background-color: #feff9f !important;
        color: #fff;
      }

      .legend-container {
        max-width: 1200px;
        margin: 20px auto;
        display: flex;
        gap: 10px;
        color: var(--card-bg);
        font-size: 0.85rem;
        align-items: center;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        border: 1px solid var(--diamond-bg);
      }
      .legend-senin-kamis {
        background-color: #a1e3f9;
      }
      .legend-ayyamul-bidh {
        background-color: #fca997;
      }
      .legend-ramadhan {
        background-color: #d0e8c5;
      }
      .legend-idul-fitri {
        background-color: #feff9f;
      }
      @media (max-width: 768px) {
        .year-grid {
          grid-template-columns: 1fr;
          grid-row-gap: 20px;
        }
        /* Sembunyikan semua month-card kecuali yang pertama */
        .month-card {
          display: none;
        }
        .month-card:nth-child(1) {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <h1>Kalender Hijriyah</h1>

    <!-- Tampilan Desktop (kalender tahunan) -->
    <div class="desktop-calendar d-none d-md-block">
      <div class="btn-container">
        <button id="prevYearBtn" class="btn btn-year">&laquo; Prev</button>
        <span class="year-header" id="yearTitle"></span>
        <button id="nextYearBtn" class="btn btn-year">Next &raquo;</button>
      </div>
      <div id="yearGrid" class="year-grid"></div>
    </div>

    <!-- Tampilan Mobile (navigasi per bulan) -->
    <div class="mobile-calendar d-md-none">
      <div class="btn-container">
        <button id="prevMonthBtn" class="btn btn-year-mobile">&laquo;</button>
        <span id="mobileMonthTitle" class="year-header"></span>
        <button id="nextMonthBtn" class="btn btn-year-mobile">&raquo;</button>
      </div>
      <div id="mobileMonthContainer" class="year-grid"></div>
    </div>

    <!-- Legend Puasa -->
    <div class="legend-container">
      <div class="legend-item">
        <div class="legend-color legend-senin-kamis"></div>
        <div>Puasa Senin-Kamis</div>
      </div>
      <div class="legend-item">
        <div class="legend-color legend-ayyamul-bidh"></div>
        <div>13â€“15 Puasa Ayyamul Bidh</div>
      </div>
      <div class="legend-item">
        <div class="legend-color legend-ramadhan"></div>
        <div>Puasa Ramadhan</div>
      </div>
      <div class="legend-item">
        <div class="legend-color legend-idul-fitri"></div>
        <div>Idul Fitri</div>
      </div>
    </div>

    <script>
      // Daftar nama bulan Hijriyah
      const hijriMonthNames = [
        "Muharram",
        "Safar",
        "Rabiul Awal",
        "Rabiul Akhir",
        "Jumadil Awal",
        "Jumadil Akhir",
        "Rajab",
        "Syaban",
        "Ramadhan",
        "Syawal",
        "Zulkaidah",
        "Dzulhijjah",
      ];

      // Tahun Hijriyah default dan variabel untuk tampilan mobile
      let currentHijriYear = 1446;
      let currentMobileMonth = 1; // akan di-set sesuai tanggal hari ini

      // Fungsi untuk mendapatkan default bulan Hijriyah berdasarkan tanggal hari ini
      function getDefaultHijriMonth() {
        let today = new Date();
        // Iterasi di tahun sekitar currentHijriYear agar sesuai dengan tanggal hari ini
        for (
          let yearCandidate = currentHijriYear - 1;
          yearCandidate <= currentHijriYear + 1;
          yearCandidate++
        ) {
          for (let m = 1; m <= 12; m++) {
            let startGreg = hijriToGregorian(yearCandidate, m, 1);
            let nextGreg =
              m < 12
                ? hijriToGregorian(yearCandidate, m + 1, 1)
                : hijriToGregorian(yearCandidate + 1, 1, 1);
            if (today >= startGreg && today < nextGreg) {
              currentHijriYear = yearCandidate; // update tahun jika diperlukan
              return m;
            }
          }
        }
        return 1; // fallback bila tidak ditemukan
      }

      // Saat halaman load
      document.addEventListener("DOMContentLoaded", function () {
        if (window.innerWidth < 768) {
          currentMobileMonth = getDefaultHijriMonth();
          renderMobileHijriMonth();
        } else {
          renderHijriYearCalendar(currentHijriYear);
        }
      });

      // Navigasi tampilan desktop (per tahun)
      document
        .getElementById("prevYearBtn")
        .addEventListener("click", function () {
          currentHijriYear--;
          renderHijriYearCalendar(currentHijriYear);
        });
      document
        .getElementById("nextYearBtn")
        .addEventListener("click", function () {
          currentHijriYear++;
          renderHijriYearCalendar(currentHijriYear);
        });

      // Navigasi tampilan mobile (per bulan)
      if (document.getElementById("prevMonthBtn")) {
        document
          .getElementById("prevMonthBtn")
          .addEventListener("click", function () {
            currentMobileMonth--;
            if (currentMobileMonth < 1) {
              currentMobileMonth = 12;
              currentHijriYear--;
            }
            renderMobileHijriMonth();
          });
      }
      if (document.getElementById("nextMonthBtn")) {
        document
          .getElementById("nextMonthBtn")
          .addEventListener("click", function () {
            currentMobileMonth++;
            if (currentMobileMonth > 12) {
              currentMobileMonth = 1;
              currentHijriYear++;
            }
            renderMobileHijriMonth();
          });
      }

      // Fungsi render untuk tampilan desktop (12 bulan dalam 1 tahun)
      function renderHijriYearCalendar(hYear) {
        document.getElementById("yearTitle").textContent = hYear + " H";
        const yearGrid = document.getElementById("yearGrid");
        yearGrid.innerHTML = "";
        for (let m = 1; m <= 12; m++) {
          const monthCard = document.createElement("div");
          monthCard.className = "month-card";

          const monthHeader = document.createElement("div");
          monthHeader.className = "month-header";
          monthHeader.textContent = hijriMonthNames[m - 1] + " " + hYear;
          monthCard.appendChild(monthHeader);

          const dayNamesDiv = document.createElement("div");
          dayNamesDiv.className = "day-names";
          const dayLabels = ["Ahd", "Sen", "Sel", "Rab", "Kam", "Jum", "Sab"];
          dayLabels.forEach((lbl) => {
            const dEl = document.createElement("div");
            dEl.textContent = lbl;
            dayNamesDiv.appendChild(dEl);
          });
          monthCard.appendChild(dayNamesDiv);

          const calendarGrid = document.createElement("div");
          calendarGrid.className = "calendar-grid";
          monthCard.appendChild(calendarGrid);

          renderHijriMonth(hYear, m, calendarGrid);
          yearGrid.appendChild(monthCard);
        }
      }

      // Fungsi render untuk tampilan mobile (satu bulan per tampilan)
      function renderMobileHijriMonth() {
        const mobileContainer = document.getElementById("mobileMonthContainer");
        mobileContainer.innerHTML = "";
        document.getElementById("mobileMonthTitle").textContent =
          hijriMonthNames[currentMobileMonth - 1] + " " + currentHijriYear;
        const monthCard = document.createElement("div");
        monthCard.className = "month-card";

        // Buat elemen .month-header seperti biasa
        const monthHeader = document.createElement("div");
        monthHeader.className = "month-header";

        // Buat wadah flex di dalam monthHeader
        const headerContainer = document.createElement("div");
        headerContainer.className = "header-container"; // akan di-styling via CSS

        // Bagian kiri: Hijri
        const hijriLeft = document.createElement("div");
        hijriLeft.className = "hijri-left";
        hijriLeft.textContent = `${
          hijriMonthNames[currentMobileMonth - 1]
        } ${currentHijriYear}`;

        // Bagian kanan: Tanggal dan waktu (tanpa detik)
        let now = new Date();
        let dateOptions = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        };
        let dateString = now.toLocaleDateString("id-ID", dateOptions);
        // Hilangkan detik dari jam
        let timeOptions = { hour: "2-digit", minute: "2-digit" };
        let timeString = now.toLocaleTimeString("id-ID", timeOptions);

        const dateRight = document.createElement("div");
        dateRight.className = "date-right";
        dateRight.innerHTML = `${dateString}<br>${timeString}`;

        // Masukkan kedua elemen ke headerContainer
        headerContainer.appendChild(hijriLeft);
        headerContainer.appendChild(dateRight);

        // Masukkan headerContainer ke dalam monthHeader
        monthHeader.appendChild(headerContainer);

        // Terakhir, masukkan monthHeader ke dalam monthCard
        monthCard.appendChild(monthHeader);

        const dayNamesDiv = document.createElement("div");
        dayNamesDiv.className = "day-names";
        const dayLabels = ["Ahd", "Sen", "Sel", "Rab", "Kam", "Jum", "Sab"];
        dayLabels.forEach((lbl) => {
          const dEl = document.createElement("div");
          dEl.textContent = lbl;
          dayNamesDiv.appendChild(dEl);
        });
        monthCard.appendChild(dayNamesDiv);

        const calendarGrid = document.createElement("div");
        calendarGrid.className = "calendar-grid";
        monthCard.appendChild(calendarGrid);

        renderHijriMonth(currentHijriYear, currentMobileMonth, calendarGrid);
        mobileContainer.appendChild(monthCard);
      }

      // Fungsi untuk merender kalender satu bulan
      function renderHijriMonth(hYear, hMonth, containerEl) {
        containerEl.innerHTML = "";
        const startGreg = hijriToGregorian(hYear, hMonth, 1);
        const nextGreg =
          hMonth < 12
            ? hijriToGregorian(hYear, hMonth + 1, 1)
            : hijriToGregorian(hYear + 1, 1, 1);
        const daysInMonth = dateDiffInDays(startGreg, nextGreg);
        const startWeekday = startGreg.getDay();
        for (let i = 0; i < startWeekday; i++) {
          const emptyCell = document.createElement("div");
          emptyCell.className = "calendar-cell";
          containerEl.appendChild(emptyCell);
        }
        for (let d = 1; d <= daysInMonth; d++) {
          const cell = document.createElement("div");
          cell.classList.add("calendar-cell");
          const currentGreg = addDays(startGreg, d - 1);
          const weekday = currentGreg.getDay();
          if (weekday === 0) {
            cell.classList.add("sunday");
          }

          // Jika bulan adalah Ramadhan, highlight semua hari (1-30) dengan warna khusus
          if (hMonth === 9) {
            cell.classList.add("puasa-ramadhan");
          } else {
            if (weekday === 1 || weekday === 4) {
              cell.classList.add("puasa-senin-kamis");
            }
            if (d >= 13 && d <= 15) {
              cell.classList.add("puasa-ayyamul-bidh");
            }
          }

          // Jika bulan Syawal dan hari pertama, maka highlight sebagai Idul Fitri
          if (hMonth === 10 && d === 1) {
            cell.classList.add("idul-fitri");
          }

          cell.innerHTML = `
          <div class="date-hijri">${d}</div>
          <div class="date-greg">${currentGreg.getDate()} ${getGregMonthName(
            currentGreg.getMonth() + 1
          )}</div>
        `;
          containerEl.appendChild(cell);
        }
      }

      // Fungsi bantu konversi dan utilitas
      function hijriToGregorian(hYear, hMonth, hDay) {
        const jd =
          Math.floor((11 * hYear + 3) / 30) +
          354 * hYear +
          30 * hMonth -
          Math.floor((hMonth - 1) / 2) +
          hDay +
          1948440 -
          385;
        let l = jd + 68569;
        const n = Math.floor((4 * l) / 146097);
        l = l - Math.floor((146097 * n + 3) / 4);
        const i = Math.floor((4000 * (l + 1)) / 1461001);
        l = l - Math.floor((1461 * i) / 4) + 31;
        const j = Math.floor((80 * l) / 2447);
        const day = l - Math.floor((2447 * j) / 80);
        l = Math.floor(j / 11);
        const month = j + 2 - 12 * l;
        const year = 100 * (n - 49) + i + l;
        return new Date(year, month - 1, day);
      }

      function dateDiffInDays(a, b) {
        const _MS_PER_DAY = 1000 * 60 * 60 * 24;
        return Math.round((b - a) / _MS_PER_DAY);
      }

      function addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
      }

      function getGregMonthName(m) {
        const names = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "Mei",
          "Jun",
          "Jul",
          "Agu",
          "Sep",
          "Okt",
          "Nov",
          "Des",
        ];
        return names[m - 1];
      }
    </script>
  </body>
</html>
